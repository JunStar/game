<!DOCTYPE html>
<html>
  <head>
      <link href="http://wei.qq275.com/vapp/shangjieba.png" rel="shortcut icon" type="image/vnd.microsoft.icon">
      <title>世纪联华刮刮卡</title>
      <meta charset="utf-8">

        <script src="http://wx.51self.com/js/jquery.min.js"></script>

      <script>  
        function click_ad(idx){
          ajax = new XMLHttpRequest();
          ajax.open('GET', "/weitest/click_stat?id=" + idx, true);
          ajax.send(null);
          return false;
        }
      </script>

      <meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="target-densitydpi=320,width=640,user-scalable=no">



  <style type="text/css"> 
    html, body{
                margin: 0;
                padding: 0;
                height: 100%;
            }

            #wrapper {
                margin-left: auto;
                margin-right: auto;
                width: 720px;                  
                min-height: 100%;
                background:  url(http://wx.51self.com/img/card/image2/coupon_bg.png) no-repeat left top ;
            }

            #eraser {
                width: 562px;
                height: 302px;
            }

            .content {
                position: absolute;
                left: 100px;
                top: 290px;
                z-index: 2;
            }


          .container1{
                position: absolute;            
                top: 690px;
                z-index: 2;
                width: 720px;    
                margin-left: auto;
                margin-right: auto;
                background: #eeeeee;
                padding-bottom: 32px;
            }


            #back-board {
                position: absolute;
                left: 100px;
                top: 290px;
                z-index: 0;
            }

.top_barcode {
   position: absolute;
   left: 100px;
   top: 580px;
}

.top_barcode p{
  margin: 0;
  color: #000000;
  font-size: 15pt;
}

@media screen and (min-width: 1024px) {
    .container {     
        width: 740px;
        margin-left: auto;
        margin-right: auto;
        background: #eeeeee;
        padding-bottom: 32px;
    }
}

.item-list {
    border-radius: 15px;
    margin-top: 16px;
    margin-left: 16px;
    margin-right: 16px;
    font-size: 12px;
    background-color: #ffffff;
    box-shadow:-1px 0 1px #dbdbdb,
    1px 0 1px #dbdbdb,  
    0 -1px 1px #dbdbdb,
    0 1px 1px #dbdbdb;
}

.item-list-detail {
    height: 74px;
    line-height: 74px;
    vertical-align: middle;
    padding: 0 16px;
    border-top: 2px solid #eeeeee;  
}

.item-list-detail:first-child {
  border-bottom: 0;
}

.item-list-header {
    height: 69px;
    line-height: 69px;
    background-color: #e72b2b;
    color: #ffffff;
    border-top-left-radius: 15px;
    border-top-right-radius: 15px;
    text-align: center;
    vertical-align: middle;
}

.item-list-footer {
  height: 42px;
  background-color: #ffffff;
  border-bottom-left-radius: 15px;
  border-bottom-right-radius: 15px;
}

.item-list-footer img{
    float: right;
}

.userphoto {
    display: inline-block;
    width: 64px;
    height: 64px;
    border-radius: 50% 50%;
    vertical-align: middle;
}

.item-list-detail span {
    line-height: 74px;
    vertical-align: middle;
}

.right {
  float: right;
  color: #e72b2b;
}

.QRcode {
  margin: 16px 16px 0;
  background-color: #ffffff;
  border-radius: 15px;
  padding-bottom: 10px;
  box-shadow:-1px 0 1px #dbdbdb,
    1px 0 1px #dbdbdb,  
    0 -1px 1px #dbdbdb,
    0 1px 1px #dbdbdb;
}

.QRcode img {
  display: block;
  margin: 0 auto;
  padding: 40px 0 0;
}

.QRcode p {
  line-height: 1em;
  margin: 0;
  margin-bottom: 6px;
}

  </style>
   
 </head>


<script src='http://res.wx.qq.com/open/js/jweixin-1.0.0.js' type='text/javascript'></script>
<script>
  wx.config({
    debug: false,
    appId: "wx629a5ad4f3fc5f63",
    timestamp: 1428714918,
    nonceStr:  "ff52fad19c9d8d0a2ee6901273c63e42",
    signature: "c268fcd58e90fd86a505af5f69a97c28127d4f4e",
    jsApiList: [
      'onMenuShareTimeline',
      'onMenuShareAppMessage',
      'onMenuShareQQ',
      'onMenuShareWeibo',
      'hideMenuItems',
      'showMenuItems'
    ]
  });

function share_api(){
  var share_callback_hy = function () {
      ajax = new XMLHttpRequest();
      ajax.open('GET', '/materials/wx_share?f=hy_1265243610', true);
      ajax.send(null);
  }

  var share_callback_pyq = function () {
      ajax = new XMLHttpRequest();
      ajax.open('GET', '/materials/wx_share?f=pyq_1265243610', true);
      ajax.send(null);
  }



  wx.ready(function(){
    var info = $("#info").text();
    wx.onMenuShareTimeline({
      title: info + "世纪联华刮刮卡", // 分享标题
      link: "", // 分享链接
      imgUrl: "http://www.51self.com/img/card/image/sjlh.jpg", // 分享图标
      success: function () {
        share_callback_pyq();
        // 用户确认分享后执行的回调函数
      },
      cancel: function () { 
        // 用户取消分享后执行的回调函数
      }
    });

    wx.onMenuShareAppMessage({
      title: info + "世纪联华刮刮卡", // 分享标题
      desc: "赶快来刮哦", // 分享描述
      link: "", // 分享链接
      imgUrl: "http://www.51self.com/img/card/image/sjlh.jpg", // 分享图标
      type: '', // 分享类型,music、video或link，不填默认为link
      dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
      success: function () {
        share_callback_hy();
        // 用户确认分享后执行的回调函数
      },
      cancel: function () { 
        // 用户取消分享后执行的回调函数
      }
    });
  });

}

share_api();

</script>

  <script type="text/javascript">
           var isshow = false;
       
        var timer = null;
        var start_timer = function () {   
            document.getElementById('back-board').style.visibility = 'visible';        
        }
  
        window.onload = function () {
            (function (bodyStyle) {              
                 bodyStyle.mozUserSelect = 'none';
                 bodyStyle.webkitUserSelect = 'none';
                 var canvas = document.querySelector('canvas#eraser');
                 canvas.width = 562;
                 canvas.height = 302;
                 canvas.style.backgroundColor='transparent';
                 canvas.style.position = 'absolute';
                 canvas.style.zIndex = 2;
                 var opened = false;
                 (function (e) {
                      var ctx;
                      var top_left = {'x': 150, 'y': 90};
                      var bottom_right = {'x': 450, 'y': 200};
                      var last = false;
                      var current = false;
                      function getMousePos(canvas, evt) {
                          var rect = canvas.getBoundingClientRect();
                          return {
                              x: evt.clientX - rect.left,
                              y: evt.clientY - rect.top
                          };
                      }
                      function eventDown(e) {
                          e.preventDefault();
                          last = false;
                          start_timer();
                      }
                      function eventUp(e) {
                          e.preventDefault();                        
                          if ( ! opened && check()) {
                              opened = true;
                              ctx.clearRect(0, 0, canvas.width, canvas.height);
                          }
                      }
                      function eventMove(e) {
                          e.preventDefault();
                          if (e.changedTouches) {
                              for (var j = 0; j < e.changedTouches.length; j++) {
                                  _e = e.changedTouches[j];
                                  var position = getMousePos(canvas, _e);
                                  drawPoint(position);
                                  if (last) {
                                      current = position;
                                      ctx.beginPath();
                                      ctx.moveTo(last.x, last.y);
                                      ctx.lineTo(current.x, current.y);
                                      ctx.lineWidth = 60;
                                      ctx.stroke();
                                      canvas.style.zIndex = (canvas.style.zIndex == 2) ? 3 : 2;
                                  }
                                  last = position;
                              }
                          }
                      }
                      function drawPoint(position) {
                          ctx.beginPath();
                          ctx.arc(position.x, position.y, 30, 0, Math.PI * 2);
                          ctx.fill();
                      }
                      function check() {                                 
                          // 检查是否应该完全刮开
                          interactive();
                          var width = Math.max(top_left.x, bottom_right.x) -
                                Math.min(top_left.x, bottom_right.x);
                          var height = Math.max(top_left.y, bottom_right.y) -
                                Math.min(top_left.y, bottom_right.y);
                          var count = 0;
                          for (var i = Math.min(top_left.x, bottom_right.x); i < Math.max(top_left.x, bottom_right.x); i = i + 4) {
                              for (var j = Math.min(top_left.y, bottom_right.y); j < Math.max(top_left.y, bottom_right.y); j = j + 4) {
                                  var p = ctx.getImageData(i, j, 1, 1).data;
                                  if ((p[0] + p[1] + p[2] + p[3]) == 0)
                                      count += 1;
                              }
                          }
                          count = count * 16;
                          if (((width * height) / count) < 1.5){    
                             interactive();                      
                             return true;                            
                           }
                          return false;
                      }
                      ctx = canvas.getContext('2d');
                      ctx.drawImage(document.getElementById("front-board"), 0, 0);
                      ctx.globalCompositeOperation = 'destination-out';
                      var content = document.querySelector('.content');
                      content.addEventListener('touchstart', eventDown);
                      content.addEventListener('touchend', eventUp);
                      content.addEventListener('touchmove', eventMove);
                 })();
            })(document.body.style);
        }

   
  </script>

  
    <body  style="-webkit-user-select: none;">
        <div id="wrapper">   
            <div class="content">
                <div class="main-content"> 
                   <canvas id="eraser"></canvas>
                </div>
            </div>
            <div id="text-board" style="visibility: hidden;"></div>
            <img id="front-board" style="display: none;" src="http://wx.51self.com/img/card/image2/swipe_me.png"/>             
            <div id="back-board" style="visibility: none;"><img src="http://wx.51self.com/img/card/image2/ggk_get.png"/>
            </div> 

        <div id="bar-code" class="top_barcode">        
            <p class="time">使用时间：2015/04/10-2015/04/12</p>
            <p>使用门店：世纪联华中环店</p>
            <p class="method">使用方法：请到9楼信息部出示兑换</p>      
        </div>

         <div class="container1">
        <!--top part--> 
       
  
        <!--middle part , people list-->
         

        <!--bottom part , QR code-->
        <div class="QRcode">
            <img src="http://wx.51self.com/img/card/image/qr_sjlh.jpg" width="180">
            <p style="text-align: center; font-size: 14px;">扫一扫关注我</p>
            <p style="text-align: center; font-size: 12px;">了解更多世纪联华优惠资讯</p>
        </div>
    </div>
        </div>
      

    <script type="text/javascript">
               
           document.getElementById('back-board').style.visibility = 'visible';     
           document.getElementById('front-board').style.visibility = 'none';     
           document.getElementById("front-board").src = '';
      
    function interactive(){  
              
    }
    </script>

    </body>
 
 
    <div style="display: none;">                                                   
  <script src="http://v1.cnzz.com/z_stat.php?id=1000438304&web_id=1000438304" language="JavaScript"></script>
</div>   

   
    <script>
  var url="/weitest/stat?type=pv&cid=357&gid=1266&uid=3"
  var img = new Image();
  img.src = url;
</script>


</html>
